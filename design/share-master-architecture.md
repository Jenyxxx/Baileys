# 共享掌柜拓客系统架构与产品蓝图

## 产品定位
面向美容、奶茶、餐饮行业的连锁与单店老板，提供共享掌柜运营、拓客奖励与贵宾卡增长的一体化中台。支持 PC 管理端与 iPhone 16 Pro Max 小程序风格 H5，主打共享掌柜与代理协同、数字化拓客、融资运营闭环。

## 核心角色
- **平台运营方**：配置奖励方案、监控 GMV、审批掌柜
- **共享掌柜**：领取奖励方案，拉新顾客，绑定专属管家
- **专属管家**：为掌柜提供运营辅导，执行拓客剧本
- **终端顾客**：通过贵宾卡享受权益，形成复购

## 功能地图
1. **共享掌柜管理**
   - 掌柜入驻审批、档案、代理推荐关系
   - 奖励方案绑定、收益分账、状态变更
   - 专属管家分配、绩效追踪
2. **奖励方案工坊**
   - 多层级分润配置（充值金额、掌柜配额、直接/间接客源比例）
   - 生效周期、停用策略、方案模板
   - A/B 测试与实时数据回流
3. **贵宾卡中心**
   - 数字卡券发行、权益配置、渠道投放
   - 拓客引流数据、核销监测、会员分层
4. **专属管家网络**
   - 管家画像、服务区域、评分体系
   - 管家任务、掌柜绑定、辅导记录
5. **运营编排 & 数据洞察**
   - 拓客流程编排、自动化触达
   - GMV / 拉新 / 活跃 / 留存指标
   - 资金流转监控、风控预警

## 信息架构
- 九宫格首页 → 模块入口（掌柜、奖励、管家、贵宾卡、数据、运营）
- 内页 Tab（活跃/待审核/风控等维度）→ 卡片/表格 → 详情浮层
- 顶部渐变信息头部：品牌、实时 GMV、三大亮点

## 技术架构
| 层级 | 技术方案 |
| --- | --- |
| 前端 | Vue 3 + Vite + Tailwind CSS，Pinia 状态管理，Lucide Static 图标，Unsplash 素材 |
| 后端 | Node.js + Express，分层路由/服务，Prisma ORM |
| 数据 | PostgreSQL（业务主库） + Redis（会话/限流） + MongoDB（日志） |
| 基础设施 | Docker Compose（Postgres/Redis/Mongo），K8s HPA，API Gateway 限流 |
| Observability | Pino + Loki，Prometheus 指标，OpenTelemetry Trace |

## 接口设计原则
- RESTful 风格，路径以资源为中心
- 所有写操作返回资源快照，便于前端同步
- 使用 `X-App-Channel` 头部区分前端渠道
- 结合 Redis 缓存热数据，MongoDB 写入异步日志

## 性能与扩展
- PostgreSQL 水平分片，读写分离；Prisma 中间层连接池
- Redis 作为共享掌柜在线状态、奖励方案缓存，使用 TTL 管理热数据
- MongoDB 存储 EventLog，配合 Kafka（可扩展）实现异步任务
- 前端组件化复用，响应式布局，不出现滚动条，使用 CSS Grid + Flex Layout

## 测试与质量
- 前端：Storybook + Jest/Vitest 组件测试，E2E（Playwright）验证关键流程
- 后端：Jest/Supertest 覆盖 Service 与 API，Prisma Test 环境
- 合约：OpenAPI + Prism Mock 保证前后端协同

## 未来路线
1. 接入支付与分账，提供掌柜融资能力
2. 引入 AI 智能推荐奖励方案与触达剧本
3. 推出数据 API 供合作伙伴系统调用
